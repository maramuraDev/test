<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script async src="https://ga.jspm.io/npm:es-module-shims@1.7.1/dist/es-module-shims.js"></script>
  <script type="importmap">{ "imports":{ "three": "https://cdn.jsdelivr.net/npm/three@^0.156.1/build/three.module.min.js"}}</script>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@google/model-viewer/dist/model-viewer-module.min.js"></script>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@google/model-viewer-effects/dist/model-viewer-effects.min.js"></script>
  <style>
    model-viewer {
      width: 100%;
      height: 100%;
      background-color: rgb(64, 64, 64);
      position: relative;
    }
  </style>
</head>

<model-viewer shadow-intensity=".7" exposure=".4" camera-orbit="180deg 90deg auto" camera-controls touch-action="pan-y" 
autoplay src="./latest.glb" ar alt="A 3D model of a Rocket Ship">
  <effect-composer id="selectiveComposer2" render-mode="quality">
    <selective-bloom-effect id="selectiveBloom2" strength="5" radius="0" threshold="0" smoothing="2"></selective-bloom-effect>
    <color-grade-effect  ></color-grade-effect>
  </effect-composer> 

  <script type="module">
    const modelViewer = document.querySelector("model-viewer");

    // Add a function to log material names
    function logMaterialNames() {
    
    }

    // Log material names when the model is fully loaded
    modelViewer.addEventListener("load", logMaterialNames);

    const selectiveComposer2 = document.querySelector("effect-composer#selectiveComposer2");
    const selectiveBloom2 = selectiveComposer2.querySelector("selective-bloom-effect#selectiveBloom2");
  
    selectiveComposer2.addEventListener('updated-selection', () => {
  const selection = [];
  selectiveComposer2.selection.forEach((obj) => {
    // Check if the material has emissive color with a red component greater than 0
    // or if the material has the name "light"
    if ( obj.material.name === 'Material.001'|| obj.material.name === 'Luces_frontales') {
      selection.push(obj);
    }
  });
  selectiveBloom2.selection = selection;
});


     // Your animation code here
     let increasing = true;
    let strength = 0;
    const maxStrength = 10;
    const step = .7;
    const interval = 10; // in milliseconds

    function animateSelectiveBloom() {
      selectiveBloom2.strength = strength;
      if (increasing) {
        strength += step;
        if (strength > maxStrength) {
          increasing = false;
        }
      } else {
        strength -= step;
        if (strength < 0) {
          increasing = true;
        }
      }
      setTimeout(animateSelectiveBloom, interval);
    }

    animateSelectiveBloom();
  </script>
</model-viewer>
